## ADDED Requirements

### 需求:MFCP 预处理必须生成标准融合输入目录
系统必须将 MFCP 原始数据转换为与现有数据集一致的双分支输入结构，输出到 `dataset/mfcp` 下的 `pcap_data` 与 `image_data`，并按 `Train/Test` 和类别目录组织文件。

#### 场景:首次执行 MFCP 预处理
- **当** 用户执行 MFCP 预处理命令并提供有效的 SourceData 路径
- **那么** 系统在 `dataset/mfcp/pcap_data/{Train,Test}/<class>/` 生成 `.bin` 文件，并在 `dataset/mfcp/image_data/{Train,Test}/<class>/` 生成 `.png` 文件

### 需求:MFCP 图像输出必须保持 RGB 三通道
系统必须输出 RGB 三通道图像，禁止输出灰度图像或单通道图像，以保证与现有视觉分支输入分布一致。

#### 场景:校验图像通道数
- **当** 预处理完成后抽检任意 MFCP 输出图像
- **那么** 图像通道数必须为 3，且预处理日志中不得出现灰度分支启用记录

### 需求:MFCP 与既有数据集流程必须隔离
系统必须在 MFCP 数据处理过程中仅读写 MFCP 指定路径，禁止覆写或污染 `USTC-TFC2016` 与 `CICAndMal2017` 既有处理产物。

#### 场景:并存多数据集目录
- **当** 工作区中同时存在 USTC、CIC、MFCP 的数据目录并执行 MFCP 预处理
- **那么** 系统仅更新 `dataset/mfcp/**`，并保持 USTC/CIC 目录结构与文件数量不变

### 需求:预处理必须输出可审计的样本统计
系统必须在预处理完成后输出每个 split 与类别的样本数统计，便于训练前核对数据完整性。

#### 场景:生成预处理统计
- **当** MFCP 预处理任务成功结束
- **那么** 日志中必须包含按 `Train/Test` 与类别维度的样本统计信息

### 需求:首次读取后必须生成可复用索引
系统必须复用既有数据集的索引逻辑。在 MFCP 首次读取且索引不存在时，系统必须执行全量扫描并落盘索引文件；索引至少包含样本路径、类别、split 与必要校验元信息。

#### 场景:首次读取无索引
- **当** 用户首次执行 MFCP 数据读取且索引文件不存在
- **那么** 系统必须完成全量扫描并生成索引文件，且日志中记录索引创建成功

### 需求:后续读取必须优先命中有效索引
系统必须在索引存在且有效时优先使用索引加载样本列表，禁止重复执行全量目录扫描。

#### 场景:二次读取使用索引
- **当** 用户再次读取 MFCP 数据且源数据未发生变化
- **那么** 系统必须直接使用索引完成样本加载，并在日志中标记索引命中

### 需求:索引失效时必须自动重建
系统必须在检测到源数据与索引不一致时自动重建索引，禁止继续使用过期索引。

#### 场景:索引失效重建
- **当** 源数据发生新增、删除或变更导致索引校验失败
- **那么** 系统必须自动触发全量重扫并更新索引文件，同时在日志中记录重建原因

### 需求:PCAP 尾部截断时必须保留已解析样本
系统在读取 MFCP `pcap` 文件时，若前序包可解析但文件尾部出现不完整记录，必须保留已解析会话继续产出样本，并记录告警；不得因尾部残缺直接丢弃整文件。

#### 场景:尾部残缺但前序可读
- **当** 系统读取某个 `pcap` 文件并已解析出有效包，随后在尾部遇到不完整记录
- **那么** 系统必须继续使用已解析会话生成 `.bin` 与 `.png` 样本，并在日志中记录该文件的尾部截断告警

#### 场景:起始损坏无法读取
- **当** 系统读取某个 `pcap` 文件时从起始即无法解析出任何有效包
- **那么** 系统必须将该文件按解析失败处理并记录失败日志，不得输出伪造样本
